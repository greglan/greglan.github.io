---
layout: page
title:  "Some exploitation tricks"
permalink: "tricks.html"
tags: [security, exploitation]
summary: "Various useful information when developping exploits"
---

## Various information
* [Custom tools](https://github.com/greglan/sec-tools)
* View instructions encoding of binary: `objdump -D -b binary -m i386 -M intel filename.bin`
* Memory map in file: `/proc/$PID/maps`
* Check the stack flags: `readelf -l prog_name | grep GNU_STACK`
* Display dynamic relocation entries: `objdump -R filename`
* Show program header table: `readelf -l filename`
* Show section header table `readelf -S filename`
* Display relocations:` readelf -r filename`

## Exploitation outside of a debugger
* Have exactly the same environment variables, otherwise the stack is shifted. Most notably, remove the `LINES` and `COLUMNS` variables in GDB
* Start the binary from the same directory, else some envar may change (`PWD, OLDPWD`)
* Use existing envar and try to keep the length the same
* Start the debugger and program using the absolute path
* [StackOverflow on exploitation outside GDB](https://stackoverflow.com/questions/17775186/buffer-overflow-works-in-gdb-but-not-without-it/17775966#17775966)
* [Test if a payload contains filtered bytes](https://github.com/greglan/sec-tools/blob/master/check_bad_bytes.py)
* Keep stdin open: `(cat /tmp/payload;cat) | `

### Privileges drop
* [Privilege drop](https://archive.cert.uni-stuttgart.de/vuln-dev/2003/03/msg00024.html)
* [Why SUID Binary exploit does not yield root shell](https://archive.cert.uni-stuttgart.de/vuln-dev/2003/03/msg00024.html)

### Fixing addresses
* Get addresses of buffers: `ltrace prog_name`
* Return to `printf` so that we get an output of what is the target. Then fix the addresses by trial and error [1]


## Compilation flags
### Gcc
* Enable GDB debugging symbols: `-ggdb`
* Compile for 32bit systems: `-m32`
* Disable stack smashing protection: `-fno-stack-protector`
* Allow stack execution: `-z execstack`

### Others
* Force 32 bits executables (LD): `-m elf_i386`


## Resources and references
* [[1] Blopost on exploitation outside GDB](https://www.roguesecurity.in/2018/01/13/buffer-overflow-series-exploit-failing-outside-gdb/)
* [Binding TCP shellcode](https://reboare.github.io/slae/slae1.html)
